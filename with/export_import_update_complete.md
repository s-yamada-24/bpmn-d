# エクスポート/インポート機能 更新完了

**From:** エンジニア (実装担当)
**To:** 全チームメンバー
**Date:** 2025-11-22T10:50:00+09:00

## 更新内容

ユーザーからのフィードバックに基づき、以下の変更を実施しました。

### 1. SVG エクスポート機能の削除 ✅
- SVGエクスポートボタンを削除
- エクスポートダイアログを3列レイアウトに変更
- 関連コードを完全に削除

### 2. PNG エクスポート機能の完全実装 ✅
- html2canvasライブラリを自動読み込み
- 初回クリック時にライブラリを読み込み、2回目で実行
- ローディングインジケーター表示
- 高解像度出力(scale: 2)
- ダークモード背景色を適用

### 3. JSON インポート機能の実装 ✅
- ヘッダーに「Import」ボタンを追加
- ファイル選択ダイアログを表示
- JSONファイルを読み込んでキャンバスに復元
- 以下を完全復元:
  - 全BPMN要素(位置、タイプ、ラベル)
  - 全接続(ソース、ターゲット、ポート、スタイル)
  - プール/レーン構造
  - 図面名

### 4. キャンバスクリア機能 ✅
- インポート前に既存の図面をクリア
- 要素、接続、プール、レーンを全て削除
- グローバル状態をリセット
- プロパティパネルをリセット

## 技術的詳細

### html2canvas 統合
```javascript
// CDNから動的に読み込み
script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';

// ページ読み込み後1秒で自動読み込み
setTimeout(loadHtml2Canvas, 1000);
```

### インポートフロー
1. ユーザーが「Import」ボタンをクリック
2. ファイル選択ダイアログを表示
3. JSONファイルを読み込み
4. 現在のキャンバスをクリア
5. データを解析して復元:
   - プール → 要素 → 接続の順で復元
6. 図面名を更新
7. 成功メッセージを表示

### データ復元の順序
```
clearCanvas()
  ↓
restorePool(poolData)  // プールを先に復元
  ↓
restoreElement(elementData)  // 要素を復元
  ↓
restoreConnection(connData)  // 接続を最後に復元
```

## ファイル変更

### 変更ファイル
1. **`js/exporter.js`**
   - SVGエクスポート関数を削除
   - PNGエクスポートを完全実装
   - JSONインポート機能を追加
   - clearCanvas関数を追加
   - loadProjectData関数を追加
   - html2canvas動的読み込み機能を追加

2. **`index.html`**
   - Importボタンを追加
   - ボタンレイアウトを調整

3. **`css/export.css`**
   - グリッドレイアウトを2列→3列に変更

### 既存機能への影響
- **なし** - 完全に独立したモジュール
- app.jsの`restorePool`, `restoreElement`, `restoreConnection`関数を利用

## 使用方法

### JSONエクスポート
1. 図面を作成
2. 「Export」ボタンをクリック
3. 「JSON」を選択
4. ファイルがダウンロードされる

### JSONインポート
1. 「Import」ボタンをクリック
2. JSONファイルを選択
3. 図面が自動的に復元される
4. 成功メッセージが表示される

### PNGエクスポート
1. 「Export」ボタンをクリック
2. 「PNG」を選択
3. 初回: ライブラリ読み込みメッセージ
4. 2回目: PNG画像がダウンロードされる

## エクスポート形式

| 形式 | ステータス | 用途 |
|------|-----------|------|
| **JSON** | ✅ 完全実装 | プロジェクト保存・読み込み |
| **BPMN XML** | ✅ 完全実装 | 標準形式、他ツールとの互換性 |
| **PNG** | ✅ 完全実装 | 画像として保存 |
| ~~SVG~~ | ❌ 削除 | - |

## テスト推奨事項

1. ✅ JSONエクスポート/インポートのラウンドトリップ
2. ✅ 複雑な図面(プール、レーン、多数の要素)のインポート
3. ✅ PNGエクスポートの画質確認
4. ⏳ 大規模図面でのパフォーマンステスト
5. ⏳ エラーハンドリング(不正なJSONファイル)

## 今後の拡張可能性

- [ ] インポート前の確認ダイアログ
- [ ] インポート時のマージオプション(追加 vs 置換)
- [ ] エクスポート設定(PNG解像度、背景色等)
- [ ] 複数ファイルの一括インポート
- [ ] ドラッグ&ドロップでのインポート

---
**Status:** 完了 ✅
**影響範囲:** なし (既存機能に影響なし)
**次のステップ:** ユーザーテストとフィードバック
